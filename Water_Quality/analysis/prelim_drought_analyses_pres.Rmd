---
title: "Preliminary Drought Analyses - Water Quality"
author: "Drought WQ Subteam"
date: "11/4/2021"
output:
  ioslides_presentation:
    widescreen: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r prepare data, message = FALSE}
# Load packages
library(tidyverse)
library(scales)
library(DroughtData)

# Seasonal averages for entire Delta
# Add D for Drought in 2021 and convert Drought and Season to factors
lt_seasonal_mod <- lt_seasonal %>% 
  mutate(
    Drought = factor(if_else(Year == 2021, "D", Drought)),
    Season = factor(Season, levels = c("Winter", "Spring", "Summer", "Fall"))
  )

# Hydrology data
lt_seasonal_hydro <- lt_seasonal_mod %>% 
  select(Year, Season, Drought, Outflow, X2, Export) %>% 
  pivot_longer(cols = c(Outflow:Export), names_to = "Parameter", values_to = "Value") %>% 
  filter(!is.na(Value))

hydro_labels <- c(
  "Export" = "Export (cfs)", 
  "Outflow" = "Outflow (cfs)", 
  "X2" = "X2 (km)"
)

# WQ Field measurements
lt_seasonal_wq_meas <- lt_seasonal_mod %>% 
  select(Year, Season, Drought, Temperature, Secchi, Salinity) %>% 
  pivot_longer(cols = c(Temperature:Salinity), names_to = "Parameter", values_to = "Value") %>% 
  filter(!is.na(Value))

wq_meas_labels <- c(
  "Temperature" = "Water Temperature (C)", 
  "Secchi" = "Secchi Depth (cm)", 
  "Salinity" = "Salinity (PSU)"
)
```

## Hydrology metrics - D/W/N classification

```{r}
lt_seasonal_hydro %>% 
  ggplot(aes(x = Drought, y = Value)) +
  geom_boxplot() +
  facet_wrap(
    vars(Parameter), 
    scales = "free_y", 
    labeller = labeller(Parameter = hydro_labels)
  ) +
  scale_y_continuous(labels = label_comma())
```

## Hydrology metrics - Season

```{r}
lt_seasonal_hydro %>% 
  ggplot(aes(x = Season, y = Value)) +
  geom_boxplot() +
  facet_wrap(
    vars(Parameter), 
    scales = "free_y", 
    labeller = labeller(Parameter = hydro_labels)
  ) +
  scale_y_continuous(labels = label_comma())

```

